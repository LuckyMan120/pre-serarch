import { gql } from 'graphql-request'
import { restAdapter } from '../../utils/middleware'
import { request } from '../../utils/gql'

const INSERT_PROJECT = gql`
  mutation InsertProject($payload: projects_insert_input!) {
    insert_projects_one(object: $payload) {
      id
    }
  }
`

const insertSampleProject = async ({ authorId }) => {
  const data = await request(INSERT_PROJECT, {
    payload: {
      author_id: authorId,
      name: 'The Sourdough Project (sample)',
      note:
        '<h2>Introduction</h2><p>All over the world, different cultures bake their own unique breads – and have for centuries – and yet we still know very little about the microbes that make the best sourdough bread. The yeast species living in sourdough starter are fungi, but bakers that start with the same ingredients can end up with radically different cell cultures.</p><h2>Hypothesis</h2><p>All purpose flour dough will make the best bread.</p><h2>Key findings</h2><ul><li>Yeast imparts leavening power, aroma, and flavor in sourdough</li><li>Lactic acid bacteria produces complex sour flavors, improve shelf life, improve texture in sourdough</li><li>Whole wheat starter ferments faster and has a more complex flavor</li></ul>',
      experiments: {
        data: [
          {
            name: 'With all purpose flour',
            note:
              '<h1>Purpose</h1><p>It is believed that these microbes were introduced from the flour, though priori work would suggest that some of the bacteria may have originated from environmental contaminants.</p><p>Making sourdough bread culture for the purpose of baking.</p><h1>Equipment</h1><ul><li><p>Bernardin Mason jar (Order #11111)</p></li><li><p>Bounty paper napkins (Order #22222)</p></li><li><p>Alliance Rubber Rubber band (Order #33333)</p></li><li><p>Home Depot Ruler (Order #44444)</p></li><li><p>Home Depot measuring spoons (Order #55555)</p></li><li><p>Home Depot mixing spoon (Order #66666)</p></li></ul><h1>Materials</h1><ul><li><p>All-Purpose Flour (Order #15466)</p></li><li><p>Dechlorinated water (Order #19871)</p></li></ul><h1>Procedures</h1><h2><strong>Preparing the starter:</strong></h2><ul data-type="todo_list"><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Add&nbsp;2 Tbsp of flour&nbsp;and&nbsp;2 Tbsp of water&nbsp;into a jar</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Mix thoroughly into a paste, scraping down the sides of the jar with a spoon</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Cover the mouth of the jar with a paper towel and secure it with a rubber band</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Place jar in a warm location out of direct sunlight for 24 hours</p></div></li></ul><h2>Refreshing/feeding your starter</h2><ul data-type="todo_list"><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Remove 1 Tbsp of the starter and dump it into the trash or compost.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Add&nbsp;4 teaspoons&nbsp;(11/3&nbsp;Tbsp) of flour&nbsp;and&nbsp;1 Tbsp of water&nbsp;and mix well, scraping down the sides of the jar.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Cover the jar with a paper towel.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Set aside for 24 hours.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Continue to repeat the refreshing/feeding every 24 hours until you have refreshed the starter at least 14 times.</p></div></li></ul><h1>Data</h1><h2>Day 1</h2><p><code>3:35pm</code> 2.05 Tbsp flour, 2.04 Tbsp water<br><code>3:51pm</code> Mixed slurry. Strings of gluten are visible.<br><code>3:53pm</code> Placed jar in top right cabinet in the kitchen</p><h2>Day 2</h2><p><code>4:30pm</code> Dough has doubled in size and is very bubbly.<br><code>4:31pm</code> Test to see if dough floats in water.<br><code>4:35pm</code> Placed jar in top right cabinet in the kitchen</p><h2>Day 3</h2><p><code>6:00pm</code> Removed 0.51 Tbsp of starter for testing<br><code>6:10pm</code> Preparing remainder baking</p><h1>Analysis</h1><p>Studying the starter culture developed in this experiment and collected on Day 3, it was found that the predominant bacteria detected in the starter culture was Saccharomyces cerevisiae (this is the same yeast used in baking and beer), though other lactic acid bacteria in the genus Lactobacillus were also discovered.</p><p>It is believed that this lactic acid, together with vinegary-smelling acetic acid, is giving the starter a tangy smell.</p><p>A low pH also gives sourdough a longer shelf life than other breads by inhibiting mold growth.</p>',
            status: 'COMPLETED',
            is_bookmarked: false,
          },
          {
            name: 'With whole wheat flour',
            note:
              "<h1>Purpose</h1><p>Since whole wheat flour is minimally processed when you compare it with white wheat flours, whole wheat flour is said to be packed with nutrients and potential microbes, providing faster fermentation for a starter. On the other hand, the inclusion of bran can inhibit gluten development. The tiny bits of bran are sharp and act like razor blades, mechanically disrupting the bonds formed in a gluten matrix. Impeded gluten development means your bread might not rise as high, retain its shape, or effectively trap gases. Bran is also high in fiber, which makes whole wheat flour more water absorbent than processed white flour (resulting in stiffer bread doughs).</p><p>Running the first experiment, but with whole wheat flour.</p><h1>Materials</h1><ul><li><p>Whole Wheat Flour (Order #13245)</p></li></ul><h1>Analysis</h1><p>The biggest difference with last week's experiment with all purpose flour is that whole wheat flour starter seems to ferment quicker than white, so the starter needed to be fed more often.</p>",
            status: 'COMPLETED',
            is_bookmarked: true,
          },
          {
            name: 'Baking Sourdough bread',
            note:
              '<h1>Purpose</h1><p>If you bake dough, it will become bread.</p><h1>Equipment</h1><ul><li><p>Le Creuset Signature Enameled Cast Iron 5-1/2-Quart Dutch oven</p></li><li><p>GE Appliances Fridge</p></li><li><p>Glasslock glass container</p></li><li><p>Winware dough scraper</p></li><li><p>Banneton brotforms 9” in diameter (<em>budget version: mixing bowls)</em></p></li><li><p>Linen towels to line the bowls (can also use paper towels)</p></li><li><p>Clay tile</p></li><li><p>Wilton cooling rack</p></li></ul><h1>Materials</h1><ul><li><p>3 ⅔ cups all-purpose flour (regardless of what flour you used for making your starter!)</p></li><li><p>1 ¾ teaspoons salt</p></li><li><p>1 ½ cups plus 4 teaspoons water, room temperature</p></li><li><p>⅓ cup mature sourdough starter (fed 8-12 hours beforehand)</p></li></ul><h1>Procedures</h1><h2><strong>Prep</strong></h2><ul data-type="todo_list"><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Mix flour and salt in a large mixing bowl.</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Mix sourdough starter and water in a separate bowl.</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Pour wet ingredients with dry ingredients.</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Mix for 10 minutes (until the dough is smooth-looking).</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Turn the dough onto the counter and form the dough into a ball.</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Starting with the top part of the dough, stretch it up until about one-third to one-half of the dough is out of the</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>bowl and fold it back toward you. Rotate the dish counter-clockwise 90 degrees, and repeat (rotate, stretch, and fold) until you’ve done all 4 sides, 3 times.</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Coat the bowl with oil and put the dough ball back into the bowl, rolling it in the oil to coat the entire surface of the dough ball.</p></div></li><li data-type="todo_item" data-done="true"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Cover the bowl with a lid and let it sit on the counter for 12 hours.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Transfer the covered bowl to the fridge, to continue fermenting overnight.</p></div></li></ul><h2><strong>Baking</strong></h2><ul data-type="todo_list"><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Preheat oven to 500°F</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Place Dutch ovens (or baking sheets) in the oven as close to centered as possible. On a lower rack directly below the pots, place your clay tiles</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>When oven has preheated, remove bread from their cold proof.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Run a spatula around the edge of the dough ball to separate it from the wall of the bowl.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Sprinkle rice flour or cornmeal on the top surface of the dough ball.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Remove the hot baking sheet from the oven, then turn the bowl upside-down over the pan so that the dough ball</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>falls out (flour-side down) onto the hot pan.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Using a sharp knife, quickly score&nbsp;the top of the loaf at a 45-degree angle and ¼” (6mm) deep.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Place the pan (now with the scored loaf on it) into the oven on the middle rack. Close the oven door and re-set the temperature to 475°F.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Bake 20 minutes at 475°F.</p></div></li><li data-type="todo_item" data-done="false"><span class="todo-checkbox" contenteditable="false"></span><div class="todo-content"><p>Lower the temperature to 350°F and bake another 20 minutes.</p></div></li></ul><h1>Data</h1><p>Rice flour will not burn in the Dutch ovens like wheat flour.</p><p>Rice does not easily incorporate into the dough.</p><p>Coating towels with rice flower keeps them from sticking to the towels.</p><h1>Analysis</h1><p>Baking with a sourdough starter can bring other flavors to the fore, such as the caramel, earthy notes of whole wheat or the subtle sweetness of dairy. This improved flavor comes from a sourdough starter’s microbial diversity, a feature that commercial yeast lacks.</p><p>This reproduction rapidly occurs at warm temperatures (between 86–95°F, or 30–35°C), but also occurs at lower temperatures, although at a slower rate.</p>',
            status: 'IN_PROGRESS',
            is_bookmarked: true,
          },
        ],
      },
    },
  })

  return data
}

export const generateSampleProject = restAdapter(async ({ body }) => {
  const { data } = body.event

  // Insert user if doesn't exist
  await insertSampleProject({ authorId: data.new.id })

  return { message: 'Sample project created' }
})
